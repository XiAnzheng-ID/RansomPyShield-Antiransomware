import requests
import os

def get_hashes(tag="Ransomware", limit=1000):
    url = "https://mb-api.abuse.ch/api/v1/"
    headers = {"Accept": "application/json"}
    data = {
        "query": "get_taginfo",
        "tag": tag,
        "limit": limit,
    }

    response = requests.post(url, headers=headers, data=data)
    if response.status_code == 200:
        result = response.json()
        hashes = []

        # get sha256_hash from json response
        for sample in result.get("data", []):
            hash_value = sample.get("sha256_hash")
            if hash_value:
                hashes.append(hash_value)
        
        return hashes
    else:
        print(f"Error fetching data: {response.status_code}")
        return []

def save_hashes_to_file(hashes, file_path="hashes.txt"):
    try:
        with open(file_path, "w") as file:
            for hash_value in hashes:
                file.write(hash_value + "\n")
    except Exception as e:
        print(f"Error saving file: {e}")

def main():
    hashes = get_hashes(limit=1000)
    save_hashes_to_file(hashes, os.path.join(os.getenv('LOCALAPPDATA'), "RansomPyShield" , "hashes.txt"))